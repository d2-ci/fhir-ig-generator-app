"use strict";(self.webpackChunk_dhis2_app_shell=self.webpackChunk_dhis2_app_shell||[]).push([[3524],{2332:function(e,a,t){t.r(a),t.d(a,{default:function(){return O}});var r=t(2176),n=t(357),l=t.n(n),o=t(9618),i=t.n(o),s=t(915),c=t.n(s);const m=e=>e.replace(/[^a-zA-Z0-9\s.-]/g," ").trim().split(/[\s_-]+/).map((e=>e===e.toUpperCase()?e:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())).filter((e=>e)).join(""),p=e=>e.replace(/[^a-zA-Z0-9\s]/g," ").trim().split(/\s+/).map(((e,a)=>0==a?e.toLowerCase():e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())).join(""),u=()=>{c().registerHelper("toPascalCase",(function(e){return m(e)})),c().registerHelper("toKebabCase",(function(e){return(e=>e.replace(/[^a-zA-Z0-9\s.-]/g," ").trim().split(/\s+/).map((e=>e.toLowerCase())).filter((e=>e)).join("-"))(e)})),c().registerHelper("toCamelCase",(function(e){return p(e)})),c().registerHelper("toFhirDataType",(function(e,a){return function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])return"code";switch(e){case"TEXT":case"LONG_TEXT":case"EMAIL":case"PHONE_NUMBER":default:return"string";case"NUMBER":case"PERCENTAGE":case"UNIT_INTERVAL":return"decimal";case"INTEGER":case"INTEGER_NEGATIVE":return"integer";case"INTEGER_POSITIVE":return"positiveInt";case"INTEGER_ZERO_OR_POSITIVE":return"unsignedInt";case"DATE":return"date";case"DATETIME":return"dateTime";case"TIME":return"time";case"BOOLEAN":case"TRUE_ONLY":return"boolean";case"URL":return"url";case"FILE_RESOURCE":case"IMAGE":return"Attachment";case"AGE":return"Age"}}(e,a)})),c().registerHelper("toFhirCardinality",(function(e){return(e=>e?"1":"0")(e)})),c().registerHelper("toFhirElementDescription",(function(e){return(a=e).description?a.description:a.name;var a})),c().registerHelper("isRepeatable",(function(e){return(e=>e?"*":"1")(e)})),c().registerHelper("toFhirDataElementName",(function(e){return(e=>{if(!e.name)throw new Error("Element must have a name property.");const a=[e.formName,e.displayName,e.shortName,e.name].filter(Boolean);for(let t of a){const e=p(t);if(e.length<=64)return e}throw new Error("Both formName and shortName are too long to be a valid FHIR data element name.")})(e)}))};var d=t(2349);const f=(e,a,t)=>{u();l().getBinaryContent("./assets/ig.zip",(function(r,n){if(r)throw r;i().loadAsync(n).then((function(){const r=new(i());r.loadAsync(n).then((async function(){await g(r,t),await v(r,t.id),e.forEach((e=>{E(e,a,r)}))})).then((function(){(async e=>{const a=await e.generateAsync({type:"blob"}),t=URL.createObjectURL(a),r=document.createElement("a");r.href=t,r.download="ig.zip",r.click(),URL.revokeObjectURL(t)})(r)}))}))}))},E=(e,a,t)=>{const{programLogicalModelTemplate:r,programStageLogicalModelTemplate:n,codeSystemTemplate:l,valueSetTemplate:o}=a,i=h(e,r),s=m(e.name);t.file(`input/fsh/models/${s}.fsh`,i),e.programTrackedEntityAttributes.forEach((e=>{var a=e.trackedEntityAttribute;if(a.optionSet){const e=m(a.optionSet.name),r=h(a.optionSet,l),n=h(a.optionSet,o);t.file(`input/fsh/codesystems/${e}CS.fsh`,r),t.file(`input/fsh/valuesets/${e}VS.fsh`,n)}})),e.programStages.forEach((e=>{const a=h(e,n),r=m(e.name);t.file(`input/fsh/models/${r}.fsh`,a),e.programStageDataElements.forEach((e=>{let{dataElement:a}=e;if(a.optionSet){const e=m(a.optionSet.name),r=h(a.optionSet,l),n=h(a.optionSet,o);t.file(`input/fsh/codesystems/${e}CS.fsh`,r),t.file(`input/fsh/valuesets/${e}VS.fsh`,n)}}))}))},h=(e,a)=>c().compile(a)(e),g=async(e,a)=>{const t=await e.file("sushi-config.yaml").async("string");let r=d.Ay.parseDocument(t);Object.entries(a).forEach((e=>{let[a,t]=e;r.set(a,t)})),e.file("sushi-config.yaml",r.toString())},v=async(e,a)=>{const t=await e.file("ig.ini").async("string");t.replace("fhir.example",a);const r=t.replace("fhir.example",a);e.file("ig.ini",r)};var b=t(7329);var N=function(e){let{programs:a,selectedProgramIds:t,setSelectedProgramIds:n}=e;const l=a.map((e=>({value:e.id,label:e.displayName})));return r.createElement("div",null,r.createElement(b.m,{label:"Select Tracker Programs",selected:t,onChange:e=>{let{selected:a}=e;n(Array.isArray(a)?a:[])},options:l,leftHeader:"Available Tracker Programs",rightHeader:"Selected Tracker Programs",filterable:!0}))},T=t(6420),y=t(615),S=t(2721),I=t(7158),_=t(1039),w="IGConfigForm_container__aeTBz",A="IGConfigForm_row__CEtNb",D="IGConfigForm_inputField__mF4XE";var C=e=>{let{onSubmit:a}=e;return r.createElement("div",{className:w},r.createElement("h2",null,"Implementation Guide Configuration"),r.createElement(T.lV,{onSubmit:a,initialValues:{id:"fhir.example",name:"Example IG",canonical:"http://example.org",status:"draft",version:"0.1.0",releaseLabel:"ci-build",publisher:{name:"DHIS2",url:"https://dhis2.org"}}},(e=>{let{handleSubmit:a}=e;return r.createElement("form",{onSubmit:a},r.createElement("div",{className:A},r.createElement(T.D0,{required:!0,name:"id",label:"ID",component:y.f,className:D,validate:S.a,helpText:"The unique identifier for the IG. Default: fhir.example"})),r.createElement("div",{className:A},r.createElement(T.D0,{required:!0,name:"name",label:"Name",component:y.f,className:D,validate:S.a,helpText:"Default: ExampleIG"})),r.createElement("div",{className:A},r.createElement(T.D0,{required:!0,name:"canonical",label:"Canonical",component:y.f,className:D,validate:S.a,helpText:"Default: http://example.org"})),r.createElement("div",{className:A},r.createElement(T.D0,{required:!0,name:"status",label:"Status",component:I.T,className:D,validate:S.a,helpText:"Default: draft",options:[{label:"draft",value:"draft"},{label:"active",value:"active"},{label:"retired",value:"retired"},{label:"unknown",value:"unknown"}]})),r.createElement("div",{className:A},r.createElement(T.D0,{required:!0,name:"version",label:"Version",component:y.f,className:D,validate:S.a,helpText:"Default: 0.1.0"})),r.createElement("div",{className:A},r.createElement(T.D0,{required:!0,name:"releaseLabel",label:"Release Label",component:y.f,className:D,validate:S.a,helpText:"Default: ci-build"})),r.createElement("div",{className:A},r.createElement(T.D0,{required:!0,name:"publisher.name",label:"Publisher",component:y.f,className:D,validate:S.a,helpText:"Default: DHIS2"})),r.createElement("div",{className:A},r.createElement(T.D0,{required:!0,name:"publisher.url",label:"Publisher URL",component:y.f,className:D,validate:S.a,helpText:"Default: https://dhis2.org"})),r.createElement("div",{className:A},r.createElement(_.$,{type:"submit",primary:!0,large:!0},"Set Configuration")))})))},L=t(5272);const R={programs:{resource:"programs",params:{filter:"programType:eq:WITH_REGISTRATION",fields:["id","displayName","name","description","enrollmentDateLabel","incidentDateLabel","programTrackedEntityAttributes[mandatory,trackedEntityAttribute[name,shortName,formName,displayName,valueType,description,optionSet[name,valueType,options[code,name]]]]","programStages[name,description,repeatable,programStageDataElements[dataElement[name,shortName,formName,displayName,valueType,optionSet[name,options[code,name]]]]]"]}}},k=[{key:"programLogicalModelTemplate",fileName:"ProgramLogicalModel.fsh.handlebars"},{key:"programStageLogicalModelTemplate",fileName:"ProgramStageLogicalModel.fsh.handlebars"},{key:"codeSystemTemplate",fileName:"CodeSystem.fsh.handlebars"},{key:"valueSetTemplate",fileName:"ValueSet.fsh.handlebars"}];var x=t(591),G=t(4349),H="App_container__KkHQY",P="App_downloadButton__1njqx";var O=()=>{const[e,a]=(0,r.useState)([]),[t,n]=(0,r.useState)(null),{programs:l,error:o,loading:i}=(()=>{var e,a;const{data:t,error:r,loading:n}=(0,L.iO)(R);return{programs:null!==(e=null===t||void 0===t||null===(a=t.programs)||void 0===a?void 0:a.programs)&&void 0!==e?e:[],error:r,loading:n}})(),{templates:s,error:c}=(()=>{const[e,a]=(0,r.useState)(null),[t,n]=(0,r.useState)(null);return(0,r.useEffect)((()=>{let e=!0;const r=async e=>{const a=await fetch(`./assets/${e}`);if(!a.ok)throw new Error(`Failed to fetch template: ${e}`);return await a.text()};return(async()=>{try{const t={};for(const{key:e,fileName:a}of k)t[e]=await r(a);e&&a(t)}catch(t){console.error(t),e&&n(t)}})(),()=>{e=!1}}),[]),{templates:e,error:t}})();if(o||c)return console.error("Error: ",o||c),r.createElement(x.I,{title:"Error",error:!0},"There was an error loading data.");if(i||!s)return r.createElement(G.F,null);const m=l.filter((a=>e.includes(a.id))),p=e=>{n(e)};return t?r.createElement("div",{className:H},r.createElement(N,{programs:l,selectedProgramIds:e,setSelectedProgramIds:a}),r.createElement("div",{className:P},r.createElement(_.$,{primary:!0,onClick:()=>f(m,s,t),disabled:0===m.length||!t||!s},"Download FHIR IG"))):r.createElement("div",{className:H},r.createElement(C,{onSubmit:p}))}}}]);
//# sourceMappingURL=app.d2335bb2.chunk.js.map