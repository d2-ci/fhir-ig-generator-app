"use strict";(self.webpackChunk_dhis2_app_shell=self.webpackChunk_dhis2_app_shell||[]).push([[3524],{2332:function(e,t,a){a.r(t),a.d(t,{default:function(){return q}});var r=a(2176),n=a(357),l=a.n(n),o=a(9618),i=a.n(o),s=a(915),c=a.n(s);const m=e=>e.replace(/[^a-zA-Z0-9\s.-]/g," ").trim().split(/[\s_-]+/).map((e=>e===e.toUpperCase()?e:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())).filter((e=>e)).join(""),p=e=>e.replace(/[^a-zA-Z0-9\s]/g," ").trim().split(/\s+/).map(((e,t)=>0==t?e.toLowerCase():e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())).join(""),u=()=>{c().registerHelper("toPascalCase",(function(e){return m(e)})),c().registerHelper("toKebabCase",(function(e){return(e=>e.replace(/[^a-zA-Z0-9\s.-]/g," ").trim().split(/\s+/).map((e=>e.toLowerCase())).filter((e=>e)).join("-"))(e)})),c().registerHelper("toCamelCase",(function(e){return p(e)})),c().registerHelper("toFhirDataType",(function(e,t){return function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])return"code";switch(e){case"TEXT":case"LONG_TEXT":case"EMAIL":case"PHONE_NUMBER":default:return"string";case"NUMBER":case"PERCENTAGE":case"UNIT_INTERVAL":return"decimal";case"INTEGER":case"INTEGER_NEGATIVE":return"integer";case"INTEGER_POSITIVE":return"positiveInt";case"INTEGER_ZERO_OR_POSITIVE":return"unsignedInt";case"DATE":return"date";case"DATETIME":return"dateTime";case"TIME":return"time";case"BOOLEAN":case"TRUE_ONLY":return"boolean";case"URL":return"url";case"FILE_RESOURCE":case"IMAGE":return"Attachment";case"AGE":return"Age"}}(e,t)})),c().registerHelper("toFhirCardinality",(function(e){return(e=>e?"1":"0")(e)})),c().registerHelper("toFhirElementDescription",(function(e){return(t=e).description?t.description:t.name;var t})),c().registerHelper("isRepeatable",(function(e){return(e=>e?"*":"1")(e)})),c().registerHelper("toFhirDataElementName",(function(e){return(e=>{if(!e.name)throw new Error("Element must have a name property.");const t=[e.formName,e.displayName,e.shortName,e.name].filter(Boolean);for(let a of t){const e=p(a);if(e.length<=64)return e}throw new Error("Both formName and shortName are too long to be a valid FHIR data element name.")})(e)}))};var d=a(2349);const f=(e,t,a)=>{u();l().getBinaryContent("./assets/ig.zip",(function(r,n){if(r)throw r;i().loadAsync(n).then((function(){const r=new(i());r.loadAsync(n).then((async function(){await E(r,a),await b(r,a.id),e.forEach((e=>{h(e,t,r)}))})).then((function(){(async e=>{const t=await e.generateAsync({type:"blob"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download="ig.zip",r.click(),URL.revokeObjectURL(a)})(r)}))}))}))},h=(e,t,a)=>{const{programLogicalModelTemplate:r,programStageLogicalModelTemplate:n,codeSystemTemplate:l,valueSetTemplate:o}=t,i=g(e,r),s=m(e.name);a.file(`input/fsh/models/${s}.fsh`,i),e.programTrackedEntityAttributes.forEach((e=>{var t=e.trackedEntityAttribute;if(t.optionSet){const e=m(t.optionSet.name),r=g(t.optionSet,l),n=g(t.optionSet,o);a.file(`input/fsh/codesystems/${e}CS.fsh`,r),a.file(`input/fsh/valuesets/${e}VS.fsh`,n)}})),e.programStages.forEach((e=>{const t=g(e,n),r=m(e.name);a.file(`input/fsh/models/${r}.fsh`,t),e.programStageDataElements.forEach((e=>{let{dataElement:t}=e;if(t.optionSet){const e=m(t.optionSet.name),r=g(t.optionSet,l),n=g(t.optionSet,o);a.file(`input/fsh/codesystems/${e}CS.fsh`,r),a.file(`input/fsh/valuesets/${e}VS.fsh`,n)}}))}))},g=(e,t)=>c().compile(t)(e),E=async(e,t)=>{const a=await e.file("sushi-config.yaml").async("string");let r=d.Ay.parseDocument(a);Object.entries(t).forEach((e=>{let[t,a]=e;r.set(t,a)})),e.file("sushi-config.yaml",r.toString())},b=async(e,t)=>{const a=await e.file("ig.ini").async("string");a.replace("fhir.example",t);const r=a.replace("fhir.example",t);e.file("ig.ini",r)};var T=a(7329);var v=function(e){let{programs:t,selectedProgramIds:a,setSelectedProgramIds:n}=e;const l=t.map((e=>({value:e.id,label:e.displayName})));return r.createElement("div",null,r.createElement(T.m,{label:"Select Tracker Programs",selected:a,onChange:e=>{let{selected:t}=e;n(Array.isArray(t)?t:[])},options:l,leftHeader:"Available Tracker Programs",rightHeader:"Selected Tracker Programs",filterable:!0}))},N=a(6420),S=a(615),y=a(2721),I=a(7158),_=a(1039),C="IGConfigForm_centerWrapper__IFjq3",D="IGConfigForm_container__aeTBz",A="IGConfigForm_gridContainer__GCUtD",w="IGConfigForm_title__cnvS9",L="IGConfigForm_inputField__mF4XE",R="IGConfigForm_button__bz4FP";var k=e=>{let{onSubmit:t}=e;return r.createElement("div",{className:C},r.createElement("div",{className:D},r.createElement("h2",{className:w},"Implementation Guide Configuration"),r.createElement(N.lV,{onSubmit:t,initialValues:{id:"fhir.example",name:"Example IG",canonical:"http://example.org",status:"draft",version:"0.1.0",releaseLabel:"ci-build",publisher:{name:"DHIS2",url:"https://dhis2.org"}}},(e=>{let{handleSubmit:t}=e;return r.createElement("form",{onSubmit:t},r.createElement("div",{className:A},r.createElement(N.D0,{required:!0,name:"id",label:"ID",component:S.f,className:L,validate:y.a,helpText:"The unique identifier for the IG. Default: fhir.example"}),r.createElement(N.D0,{required:!0,name:"name",label:"Name",component:S.f,className:L,validate:y.a,helpText:"Default: ExampleIG"}),r.createElement(N.D0,{required:!0,name:"canonical",label:"Canonical",component:S.f,className:L,validate:y.a,helpText:"Default: http://example.org"}),r.createElement(N.D0,{required:!0,name:"status",label:"Status",component:I.T,className:L,validate:y.a,helpText:"Default: draft",options:[{label:"draft",value:"draft"},{label:"active",value:"active"},{label:"retired",value:"retired"},{label:"unknown",value:"unknown"}]}),r.createElement(N.D0,{required:!0,name:"version",label:"Version",component:S.f,className:L,validate:y.a,helpText:"Default: 0.1.0"}),r.createElement(N.D0,{required:!0,name:"releaseLabel",label:"Release Label",component:S.f,className:L,validate:y.a,helpText:"Default: ci-build"}),r.createElement(N.D0,{required:!0,name:"publisher.name",label:"Publisher",component:S.f,className:L,validate:y.a,helpText:"Default: DHIS2"}),r.createElement(N.D0,{required:!0,name:"publisher.url",label:"Publisher URL",component:S.f,className:L,validate:y.a,helpText:"Default: https://dhis2.org"})),r.createElement("div",{className:R},r.createElement(_.$,{type:"submit",primary:!0,large:!0},"Set Configuration")))}))))},G=a(5272);const F={programs:{resource:"programs",params:{filter:"programType:eq:WITH_REGISTRATION",fields:["id","displayName","name","description","enrollmentDateLabel","incidentDateLabel","programTrackedEntityAttributes[mandatory,trackedEntityAttribute[name,shortName,formName,displayName,valueType,description,optionSet[name,valueType,options[code,name]]]]","programStages[name,description,repeatable,programStageDataElements[dataElement[name,shortName,formName,displayName,valueType,optionSet[name,options[code,name]]]]]"]}}},x=[{key:"programLogicalModelTemplate",fileName:"ProgramLogicalModel.fsh.handlebars"},{key:"programStageLogicalModelTemplate",fileName:"ProgramStageLogicalModel.fsh.handlebars"},{key:"codeSystemTemplate",fileName:"CodeSystem.fsh.handlebars"},{key:"valueSetTemplate",fileName:"ValueSet.fsh.handlebars"}];var H=a(591),P=a(4349),O="App_container__KkHQY",U="App_downloadButton__1njqx";var q=()=>{const[e,t]=(0,r.useState)([]),[a,n]=(0,r.useState)(null),{programs:l,error:o,loading:i}=(()=>{var e,t;const{data:a,error:r,loading:n}=(0,G.iO)(F);return{programs:null!==(e=null===a||void 0===a||null===(t=a.programs)||void 0===t?void 0:t.programs)&&void 0!==e?e:[],error:r,loading:n}})(),{templates:s,error:c}=(()=>{const[e,t]=(0,r.useState)(null),[a,n]=(0,r.useState)(null);return(0,r.useEffect)((()=>{let e=!0;const r=async e=>{const t=await fetch(`./assets/${e}`);if(!t.ok)throw new Error(`Failed to fetch template: ${e}`);return await t.text()};return(async()=>{try{const a={};for(const{key:e,fileName:t}of x)a[e]=await r(t);e&&t(a)}catch(a){console.error(a),e&&n(a)}})(),()=>{e=!1}}),[]),{templates:e,error:a}})();if(o||c)return console.error("Error: ",o||c),r.createElement(H.I,{title:"Error",error:!0},"There was an error loading data.");if(i||!s)return r.createElement(P.F,null);const m=l.filter((t=>e.includes(t.id))),p=e=>{n(e)};return a?r.createElement("div",{className:O},r.createElement(v,{programs:l,selectedProgramIds:e,setSelectedProgramIds:t}),r.createElement("div",{className:U},r.createElement(_.$,{primary:!0,onClick:()=>f(m,s,a),disabled:0===m.length||!a||!s},"Download FHIR IG"))):r.createElement(k,{onSubmit:p})}}}]);
//# sourceMappingURL=app.c3ff729b.chunk.js.map